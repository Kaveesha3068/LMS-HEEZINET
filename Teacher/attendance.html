<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="EduLMS Enhanced Multi-Class Attendance Management System - Professional attendance tracking with QR scanning, payment management, and real-time analytics">
    <meta name="keywords" content="attendance, LMS, education, class management, QR scanner, payment tracking, EduLMS">
    <meta name="author" content="EduLMS">
    <title>EduLMS - Attendance Management</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../frontend/assets/images/EduLMS-icon.ico">

    <!-- External Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">

    <!-- Bootstrap 5.3.8 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
          crossorigin="anonymous">

    <!-- Enhanced Attendance Management CSS -->
    <link rel="stylesheet" href="./styles/attendance.css">
</head>

<body>
    <!-- Mobile Menu Toggle Button -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle mobile menu">
        <span class="material-symbols-outlined">menu</span>
    </button>

    <!-- Application Container -->
    <div class="app-container">
        
        <!-- Sidebar Navigation (Dashboard Style) -->
        <div class="sidebar" id="sidebar">
            <!-- Logo Section -->
            <div class="logo">
                <img src="../frontend/assets/images/logo.png" alt="EduLMS Logo" width="32" height="32">
                <span>EduLMS</span>
            </div>

            <!-- Navigation Menu -->
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-item ">üìä Dashboard</a>
               
                <a href="attendance.html" class="nav-item active bold-text">üìã Attendance</a>
                <a href="Messages.html" class="nav-item">üí¨ Messages</a>
                <a href="calendar.html" class="nav-item">üìÖ Calendar</a>
               <a href="Courses.html" class="nav-item ">üìö Courses</a>
                <a href="Students.html" class="nav-item">üë• Students</a>
                <a href="assignments.html" class="nav-item">üìù Assignments</a>
                <a href="Financials.html" class="nav-item">üí∞ Financials</a>
            </div>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <button class="sign-out-btn" onclick="handleSignOut()">
                    <span class="sign-out-icon">üö™</span>
                    <span class="sign-out-text">Sign Out</span>
                </button>
            </div>
        </div>

      
            <!-- Attendance Reports Section -->
            <div class="card">
                <div class="card-header">
                    <h5>
                        <span class="material-symbols-outlined">analytics</span>
                        Attendance Reports
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Report Type Tabs -->
                    <ul class="nav nav-tabs" id="reportTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="daily-report-tab" data-bs-toggle="tab" data-bs-target="#daily-report" type="button" role="tab">
                                <span class="material-symbols-outlined">today</span>
                                Daily Report
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="monthly-report-tab" data-bs-toggle="tab" data-bs-target="#monthly-report" type="button" role="tab">
                                <span class="material-symbols-outlined">calendar_month</span>
                                Monthly Report
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content" id="reportTabContent">
                        <!-- Daily Report Tab -->
                        <div class="tab-pane fade show active" id="daily-report" role="tabpanel">
                            <div class="report-controls">
                                <div class="row g-3 align-items-end">
                                    <div class="col-md-3">
                                        <label for="dailyReportDate" class="form-label">Select Date</label>
                                        <input type="date" class="form-control" id="dailyReportDate" value="2025-09-17">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="dailyReportClass" class="form-label">Select Class</label>
                                        <select class="form-select" id="dailyReportClass">
                                            <option value="">All Classes</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary" id="generateDailyReportBtn">
                                                <span class="material-symbols-outlined">search</span>
                                                Generate Report
                                            </button>
                                            <button class="btn btn-success" id="downloadDailyReportBtn" disabled>
                                                <span class="material-symbols-outlined">download</span>
                                                Download CSV
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="dailyReportContent" class="report-content">
                                <div class="empty-state">
                                    <span class="material-symbols-outlined">analytics</span>
                                    <p>Select a date and class to generate daily attendance report</p>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Report Tab -->
                        <div class="tab-pane fade" id="monthly-report" role="tabpanel">
                            <div class="report-controls">
                                <div class="row g-3 align-items-end">
                                    <div class="col-md-3">
                                        <label for="monthlyReportMonth" class="form-label">Select Month</label>
                                        <select class="form-select" id="monthlyReportMonth">
                                            <option value="0">January</option>
                                            <option value="1">February</option>
                                            <option value="2">March</option>
                                            <option value="3">April</option>
                                            <option value="4">May</option>
                                            <option value="5">June</option>
                                            <option value="6">July</option>
                                            <option value="7">August</option>
                                            <option value="8" selected>September</option>
                                            <option value="9">October</option>
                                            <option value="10">November</option>
                                            <option value="11">December</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="monthlyReportYear" class="form-label">Select Year</label>
                                        <select class="form-select" id="monthlyReportYear">
                                            <option value="2023">2023</option>
                                            <option value="2024">2024</option>
                                            <option value="2025" selected>2025</option>
                                            <option value="2026">2026</option>
                                            <option value="2027">2027</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="monthlyReportClass" class="form-label">Select Class</label>
                                        <select class="form-select" id="monthlyReportClass">
                                            <option value="">All Classes</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary" id="generateMonthlyReportBtn">
                                                <span class="material-symbols-outlined">search</span>
                                                Generate Report
                                            </button>
                                            <button class="btn btn-success" id="downloadMonthlyReportBtn" disabled>
                                                <span class="material-symbols-outlined">download</span>
                                                Download CSV
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="monthlyReportContent" class="report-content">
                                <div class="empty-state">
                                    <span class="material-symbols-outlined">analytics</span>
                                    <p>Select month, year and class to generate monthly attendance report</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden input for USB card reader (keyboard emulation) -->
    <input type="text" id="cardReaderInput" class="hidden" autocomplete="off" aria-label="Card reader input" title="USB card reader input field">

    <!-- Student Details Modal -->
    <div class="modal fade" id="studentModal" tabindex="-1" aria-labelledby="studentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header modal-header-primary">
                    <h5 class="modal-title" id="studentModalLabel">
                        <span class="material-symbols-outlined">person</span>
                        Student Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Student Header -->
                    <div class="student-header">
                        <img id="modalStudentAvatar" src="" alt="Student Avatar" class="student-avatar">
                        <div class="student-info">
                            <h5 id="modalStudentName">Student Name</h5>
                            <p><strong>ID:</strong> <span id="modalStudentId">Student ID</span></p>
                            <p><strong>Class:</strong> <span id="modalStudentClass">Class Name</span></p>
                            <p><strong>Email:</strong> <span id="modalStudentEmail">student@email.com</span></p>
                            <div class="fee-status">
                                <strong>Fee Status:</strong> 
                                <span id="modalFeeStatus" class="badge bg-success">PAID</span>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Tabs -->
                    <ul class="nav nav-tabs" id="studentModalTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="attendance-tab" data-bs-toggle="tab" data-bs-target="#attendance-pane" type="button" role="tab">
                                <span class="material-symbols-outlined">how_to_reg</span>
                                Attendance Summary
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="payments-tab" data-bs-toggle="tab" data-bs-target="#payments-pane" type="button" role="tab">
                                <span class="material-symbols-outlined">payments</span>
                                Payment History
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content" id="studentModalTabContent">
                        <!-- Attendance Summary Tab -->
                        <div class="tab-pane fade show active" id="attendance-pane" role="tabpanel">
                            <div class="attendance-summary">
                                <div class="summary-card bg-success">
                                    <div class="summary-value" id="modalPresentDays">0</div>
                                    <div class="summary-label">Present Days</div>
                                </div>
                                <div class="summary-card bg-warning">
                                    <div class="summary-value" id="modalAbsentDays">0</div>
                                    <div class="summary-label">Absent Days</div>
                                </div>
                                <div class="summary-card bg-info">
                                    <div class="summary-value" id="modalAttendanceRate">0%</div>
                                    <div class="summary-label">Attendance Rate</div>
                                </div>
                                <div class="summary-card bg-primary">
                                    <div class="summary-value" id="modalTotalDays">0</div>
                                    <div class="summary-label">Total Days</div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment History Tab -->
                        <div class="tab-pane fade" id="payments-pane" role="tabpanel">
                            <div class="payment-header">
                                <h6>Payment History</h6>
                                <button class="btn btn-primary btn-sm" id="addPaymentBtn">
                                    <span class="material-symbols-outlined">add</span>
                                    Add Payment
                                </button>
                            </div>
                            <div id="paymentHistory">
                                <!-- Payment history will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="modal-footer-left">
                        <button type="button" class="btn btn-success" id="markPaidBtn">
                            <span class="material-symbols-outlined">check</span>
                            Mark Paid
                        </button>
                        <button type="button" class="btn btn-warning" id="markUnpaidBtn">
                            <span class="material-symbols-outlined">warning</span>
                            Mark Unpaid
                        </button>
                    </div>
                    <div class="modal-footer-right">
                        <button type="button" class="btn btn-primary" id="saveStudentChangesBtn">
                            <span class="material-symbols-outlined">save</span>
                            Save Changes
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <span class="material-symbols-outlined">close</span>
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header modal-header-info">
                    <h5 class="modal-title" id="addStudentModalLabel">
                        <span class="material-symbols-outlined">person_add</span>
                        Add New Student
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addStudentForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="studentName" class="form-label">Student Name</label>
                                <input type="text" class="form-control" id="studentName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="studentId" class="form-label">Student ID</label>
                                <input type="text" class="form-control" id="studentId" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="studentEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="studentEmail" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="studentClass" class="form-label">Class</label>
                                <select class="form-select" id="studentClass" required>
                                    <option value="">Select Class</option>
                                    <option value="CS101">CS 101</option>
                                    <option value="MATH201">Math 201</option>
                                    <option value="ENG102">English 102</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="studentPhone" class="form-label">Phone (Optional)</label>
                            <input type="tel" class="form-control" id="studentPhone">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <span class="material-symbols-outlined">close</span>
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="saveStudentBtn">
                        <span class="material-symbols-outlined">save</span>
                        Save Student
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div class="modal fade" id="addPaymentModal" tabindex="-1" aria-labelledby="addPaymentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header modal-header-success">
                    <h5 class="modal-title" id="addPaymentModalLabel">
                        <span class="material-symbols-outlined">add_card</span>
                        Add New Payment
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addPaymentForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="paymentAmount" class="form-label">Amount ($)</label>
                                <input type="number" class="form-control" id="paymentAmount" step="0.01" min="0" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="paymentDate" class="form-label">Payment Date</label>
                                <input type="date" class="form-control" id="paymentDate" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="paymentMethod" class="form-label">Payment Method</label>
                                <select class="form-select" id="paymentMethod" required>
                                    <option value="">Select Method</option>
                                    <option value="cash">Cash</option>
                                    <option value="credit_card">Credit Card</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                    <option value="check">Check</option>
                                    <option value="online">Online Payment</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="paymentCategory" class="form-label">Category</label>
                                <select class="form-select" id="paymentCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="tuition">Tuition Fee</option>
                                    <option value="books">Books & Materials</option>
                                    <option value="lab">Lab Fee</option>
                                    <option value="activities">Activities Fee</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="paymentNote" class="form-label">Note (Optional)</label>
                            <textarea class="form-control" id="paymentNote" rows="2" placeholder="Additional notes about this payment..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <span class="material-symbols-outlined">close</span>
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="savePaymentBtn">
                        <span class="material-symbols-outlined">save</span>
                        Save Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Scanner Modal -->
    <div class="modal fade" id="qrScannerModal" tabindex="-1" aria-labelledby="qrScannerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header modal-header-primary">
                    <h5 class="modal-title" id="qrScannerModalLabel">
                        <span class="material-symbols-outlined">qr_code_scanner</span>
                        QR Code Scanner
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="scanner-container">
                        <div class="scanner-frame">
                            <span class="material-symbols-outlined">qr_code_scanner</span>
                            <p>QR Camera Scanner</p>
                            <small>Position QR code within the frame</small>
                        </div>
                        
                        <!-- Scanner Simulation for Demo -->
                        <button class="btn btn-primary" id="simulateQRBtn">
                            <span class="material-symbols-outlined">play_arrow</span>
                            Simulate QR Scan (Demo)
                        </button>
                        
                        <div id="scanResults" class="scan-results hidden">
                            <h6><span class="material-symbols-outlined">check_circle</span>Scan Successful!</h6>
                            <p>Result: <strong id="scanResultText"></strong></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <span class="material-symbols-outlined">close</span>
                        Close Scanner
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container">
        <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <span id="toastIcon" class="material-symbols-outlined toast-icon">check_circle</span>
                <strong class="toast-title" id="toastTitle">Success</strong>
                <small id="toastTime">Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Attendance marked successfully
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <!-- Bootstrap 5.3.8 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" 
            crossorigin="anonymous"></script>
    
    <!-- Enhanced Multi-Class Attendance JavaScript -->
    <script src="./scripts/attendance.js"></script>
    <script src="./scripts/attendance-date.js"></script>
</body>
</html>
